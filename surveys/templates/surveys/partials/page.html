<p>
    You are completing {{ survey.name }} for
    {% if rater.type == 'self' %}yourself.
    {% elif rater.type == 'manager' %}your report {{ rater.ratee_full_name_or_username }}.
    {% elif rater.type == 'peer' %}your colleague {{ rater.ratee_full_name_or_username }}.
    {% elif rater.type == 'report' %}your manager {{ rater.ratee_full_name_or_username }}.
    {% endif %}
    The survey is active until {{ survey.end_date|date:"l, d.m.Y, H:i A e" }}.
</p>

<p>Page {{ rater.survey_page_number }} of {{ survey.pages.count }}</p>

<form id="testtt">
    {% for field in form.visible_fields %}
    <div id="qbox_{{ forloop.counter }}" {% if field.errors %} class="qbox-errors" {% elif field.initial != None and field.initial != "" %} class="qbox-done" {% else %} class="qbox" {% endif %}>
        {% if field.errors %}
            <div id="qbox_errs_{{ forloop.counter }}" class="errorlist">{{ field.errors }}</div>
        {% endif %}
    <div>{{ field.label }}</div>
    <br>
    {% if field.field.widget.input_type == 'radio' or field.field.widget.input_type == 'multi' %}
        {% for choice in field.field.choices %}
        <div> 
            <input type="radio" name="{{ field.name }}" id="id_{{ field.name }}_{{ choice.0 }}" value="{{ choice.0 }}" {% if field.initial == choice.0 %} checked {% endif %} {% if field.field.required %} required {% endif %} hx-post="{% url 'surveys:page' survey_id=survey.id rater_id=rater.id %}" hx-trigger="change"
            hx-on:click="
            htmx.addClass(htmx.find('#qbox_{{ forloop.parentloop.counter }}'), 'qbox-done');
            if (htmx.find('#qbox_errs_{{ forloop.parentloop.counter }}')) {
                htmx.remove(htmx.find('#qbox_errs_{{ forloop.parentloop.counter }}'));
            }
            if (htmx.find('#qbox_{{ forloop.parentloop.counter }}')) {
                htmx.removeClass(htmx.find('#qbox_{{ forloop.parentloop.counter }}'), 'qbox-errors');
            }">
            <label for="id_{{ field.name }}_{{ choice.0 }}">{{ choice.1 }}</label>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <div>
            <label for="id_{{ field.name }}"></label>
            <textarea cols="45" rows="5" maxlength="{{ field.field.widget.attrs.maxlength }}" placeholder="{{ field.field.widget.attrs.placeholder }}" name="{{ field.name }}" id="id_{{ field.name }}" {% if field.field.required %} required {% endif %} hx-post="{% url 'surveys:page' survey_id=survey.id rater_id=rater.id %}" hx-trigger="change" hx-on:click="
            htmx.addClass(htmx.find('#qbox_{{ forloop.counter }}'), 'qbox-done');
            if (htmx.find('#qbox_errs_{{ forloop.counter }}')) {
                htmx.remove(htmx.find('#qbox_errs_{{ forloop.counter }}'));
            }
            if (htmx.find('#qbox_{{ forloop.counter }}')) {
                htmx.removeClass(htmx.find('#qbox_{{ forloop.counter }}'), 'qbox-errors');
            }">{{ field.value }}</textarea> 
        </div>
        {% endif %}
    </div>
    <br>
    {% endfor %}

    <button class="btn btn-secondary" hx-get="{% url 'surveys:page' survey_id=survey.id rater_id=rater.id %}" hx-target="#main" name="back" {% if rater.survey_page_number == 1 %}disabled{% endif %} type="button">Back</button>

    <button {% if rater.survey_page_number == survey.pages.count %}class="btn btn-primary"{% else %}class="btn btn-secondary"{% endif %} id="next" type="submit" hx-target="#main" hx-swap="innerHTML show:.errorlist:top" hx-post="{% url 'surveys:page' survey_id=survey.id rater_id=rater.id %}" method="post" name="next">{% if rater.survey_page_number == survey.pages.count %}Finish{% else %}Next{% endif %}</button>
</form>